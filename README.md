# ğŸš€ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ í•˜ê¸°

> ë¯¸ì…˜ ìš”êµ¬ì‚¬í•­ì€ A, Bë§Œ í•´ë‹¹ë˜ì–´ì„œ ë“¤ì–´ê°€ê¸°ì— ì•ì„œëŠ” ì•ˆë³´ì…”ë„ ë˜êµ¬ ë³´ì…”ë„ ë˜êµ¬ ììœ ì…ë‹ˆë‹¹ !!

## ëª©ì°¨
* [ë“¤ì–´ê°€ê¸°ì— ì•ì„œ](#ë“¤ì–´ê°€ê¸°ì—-ì•ì„œ)
    * [1ë²ˆ](#ì‹¤ìŠµ-1ë²ˆ)
    * [2ë²ˆ](#ì‹¤ìŠµ-2ë²ˆ)
    * [3ë²ˆ](#ì‹¤ìŠµ-3ë²ˆ)
* [ERD of A](#erd-of-a)
* [A. ì¿¼ë¦¬ ì—°ìŠµ](#a-ì¿¼ë¦¬-ì—°ìŠµ)
  * [A1 - ì¿¼ë¦¬ ì‘ì„±ë§Œìœ¼ë¡œ 1s ì´í•˜ë¡œ ë°˜í™˜í•œë‹¤.](#a1---ì¿¼ë¦¬-ì‘ì„±ë§Œìœ¼ë¡œ-1s-ì´í•˜ë¡œ-ë°˜í™˜í•œë‹¤)
  * [A2 - ì¸ë±ìŠ¤ ì„¤ì •ì„ ì¶”ê°€í•˜ì—¬ 50 ms ì´í•˜ë¡œ ë°˜í™˜í•œë‹¤.](#a2---ì¸ë±ìŠ¤-ì„¤ì •ì„-ì¶”ê°€í•˜ì—¬-50-ms-ì´í•˜ë¡œ-ë°˜í™˜í•œë‹¤)
* [ERD of B](#erd-of-b)
* [B. ì¸ë±ìŠ¤ ì„¤ê³„](#b-ì¸ë±ìŠ¤-ì„¤ê³„)
    * [B1 - Coding as a Hobby ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ì„¸ìš”.](#b1---coding-as-a-hobby-ì™€-ê°™ì€-ê²°ê³¼ë¥¼-ë°˜í™˜í•˜ì„¸ìš”)
    * [B2 - í”„ë¡œê·¸ë˜ë¨¸ë³„ë¡œ í•´ë‹¹í•˜ëŠ” ë³‘ì› ì´ë¦„ì„ ë°˜í™˜í•˜ì„¸ìš”.](#b2---í”„ë¡œê·¸ë˜ë¨¸ë³„ë¡œ-í•´ë‹¹í•˜ëŠ”-ë³‘ì›-ì´ë¦„ì„-ë°˜í™˜í•˜ì„¸ìš”)
    * [B3 - í”„ë¡œê·¸ë˜ë°ì´ ì·¨ë¯¸ì¸ í•™ìƒ í˜¹ì€ ì£¼ë‹ˆì–´(0-2ë…„)ë“¤ì´ ë‹¤ë‹Œ ë³‘ì› ì´ë¦„ì„ ë°˜í™˜í•˜ê³  user.id ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì„¸ìš”.](#b3---í”„ë¡œê·¸ë˜ë°ì´-ì·¨ë¯¸ì¸-í•™ìƒ-í˜¹ì€-ì£¼ë‹ˆì–´0-2ë…„ë“¤ì´-ë‹¤ë‹Œ-ë³‘ì›-ì´ë¦„ì„-ë°˜í™˜í•˜ê³ -userid-ê¸°ì¤€ìœ¼ë¡œ-ì •ë ¬í•˜ì„¸ìš”)
    * [B4 - ì„œìš¸ëŒ€ë³‘ì›ì— ë‹¤ë‹Œ 20ëŒ€ India í™˜ìë“¤ì„ ë³‘ì›ì— ë¨¸ë¬¸ ê¸°ê°„ë³„ë¡œ ì§‘ê³„í•˜ì„¸ìš”.](#b4---ì„œìš¸ëŒ€ë³‘ì›ì—-ë‹¤ë‹Œ-20ëŒ€-india-í™˜ìë“¤ì„-ë³‘ì›ì—-ë¨¸ë¬¸-ê¸°ê°„ë³„ë¡œ-ì§‘ê³„í•˜ì„¸ìš”)
    * [B5 - ì„œìš¸ëŒ€ë³‘ì›ì— ë‹¤ë‹Œ 30ëŒ€ í™˜ìë“¤ì„ ìš´ë™ íšŸìˆ˜ë³„ë¡œ ì§‘ê³„í•˜ì„¸ìš”.](#b5---ì„œìš¸ëŒ€ë³‘ì›ì—-ë‹¤ë‹Œ-30ëŒ€-í™˜ìë“¤ì„-ìš´ë™-íšŸìˆ˜ë³„ë¡œ-ì§‘ê³„í•˜ì„¸ìš”)

## ë“¤ì–´ê°€ê¸°ì— ì•ì„œ
[ì‹¤ìŠµì‚¬ì´íŠ¸](https://www.w3schools.com/sql/trymysql.asp?filename=trysql_func_mysql_concat)ì—ì„œ ì•„ë˜ ë¬¸ì œë¥¼ í•´ê²°í•´ë³´ì.

ì‹¤ìŠµ ê´€ë ¨ ìˆ˜í–‰ ê³¼ì •ì€ [ì‹¤ìŠµ ê³¼ì • ì •ë¦¬](./ì‹¤ìŠµ-ê³¼ì •-ì •ë¦¬.md)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”!

### ì‹¤ìŠµ 1ë²ˆ
200ê°œ ì´ìƒ íŒ”ë¦° ìƒí’ˆëª…ê³¼ ê·¸ ìˆ˜ëŸ‰ì„ ìˆ˜ëŸ‰ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ë³´ì—¬ì£¼ì„¸ìš”.

```sql
select p.ProductID as 'ìƒí’ˆì•„ì´ë””', p.ProductName as 'ìƒí’ˆì´ë¦„', sum(od.Quantity) as 'ì´ìˆ˜ëŸ‰'
from Products p, OrderDetails od
where p.ProductID = od.ProductID
group by p.ProductID
having `ì´ìˆ˜ëŸ‰` >= 200
order by `ì´ìˆ˜ëŸ‰` desc;
```

### ì‹¤ìŠµ 2ë²ˆ
ë§ì´ ì£¼ë¬¸í•œ ìˆœìœ¼ë¡œ ê³ ê° ë¦¬ìŠ¤íŠ¸(ID, ê³ ê°ëª…)ë¥¼ êµ¬í•´ì£¼ì„¸ìš”. (ê³ ê°ë³„ êµ¬ë§¤í•œ ë¬¼í’ˆ ì´ ê°¯ìˆ˜)

```sql
select c.CustomerID as 'ê³ ê°ì•„ì´ë””', c.CustomerName as 'ê³ ê°ì´ë¦„', IFNULL(q.totalQuantity, 0) as 'ì£¼ë¬¸ëŸ‰'
from Customers c left join (
  select o.CustomerID, sum(od.Quantity) as totalQuantity
  from Orders o
         inner join OrderDetails od on o.OrderID = od.OrderID
  group by o.CustomerID) as q
                           on c.CustomerID = q.CustomerID
group by c.CustomerID
order by `ì£¼ë¬¸ëŸ‰` desc;
```

### ì‹¤ìŠµ 3ë²ˆ
ë§ì€ ëˆì„ ì§€ì¶œí•œ ìˆœìœ¼ë¡œ ê³ ê° ë¦¬ìŠ¤íŠ¸ë¥¼ êµ¬í•´ì£¼ì„¸ìš”.

```sql
select c.CustomerID as 'ê³ ê°ì•„ì´ë””', c.CustomerName as 'ê³ ê°ì´ë¦„', IFNULL(qp.Amount, 0) as 'ì§€ì¶œê¸ˆì•¡'
from Customers c left join
     (
       select o.CustomerID, sum(od.Quantity*p.Price) as Amount
       from OrderDetails od
              inner join Products p on od.ProductID = p.ProductID
              inner join Orders o on od.OrderID = o.OrderID
       group by o.CustomerID
     ) as qp on c.CustomerID = qp.CustomerID
group by c.CustomerID
order by `ì§€ì¶œê¸ˆì•¡` desc;

```



---


## ERD of A
  <img src="/images/erd-of-a.png" width="800"/>

* [reverse engineeringì„ ì´ìš©í•´ mysqlworkbench erd ìƒì„±í•˜ê¸°](https://dololak.tistory.com/457)

## A. ì¿¼ë¦¬ ì—°ìŠµ
í™œë™ì¤‘ì¸(Active) ë¶€ì„œì˜ í˜„ì¬ ë¶€ì„œê´€ë¦¬ì ì¤‘ ì—°ë´‰ ìƒìœ„ 5ìœ„ì•ˆì— ë“œëŠ” ì‚¬ëŒë“¤ì´ ìµœê·¼ì— ê° ì§€ì—­ë³„ë¡œ ì–¸ì œ í‡´ì‹¤í–ˆëŠ”ì§€ ì¡°íšŒí•´ë³´ì„¸ìš”.  
(ì‚¬ì›ë²ˆí˜¸, ì´ë¦„, ì—°ë´‰, ì§ê¸‰ëª…, ì§€ì—­, ì…ì¶œì…êµ¬ë¶„, ì…ì¶œì…ì‹œê°„)  
ê¸‰ì—¬ í…Œì´ë¸”ì˜ ì‚¬ìš©ì—¬ë¶€ í•„ë“œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í˜„ì¬ ê·¼ë¬´ì¤‘ì¸ì§€ ì—¬ë¶€ëŠ” ì¢…ë£Œì¼ì í•„ë“œë¡œ íŒë‹¨í•´ì£¼ì„¸ìš”.

### A1 - ì¿¼ë¦¬ ì‘ì„±ë§Œìœ¼ë¡œ 1s ì´í•˜ë¡œ ë°˜í™˜í•œë‹¤.

```sql
select ì—°ë´‰ìƒìœ„5ìœ„.ì‚¬ì›ë²ˆí˜¸, ì—°ë´‰ìƒìœ„5ìœ„.ì´ë¦„, ì—°ë´‰ìƒìœ„5ìœ„.ì—°ë´‰, ì—°ë´‰ìƒìœ„5ìœ„.ì§ê¸‰ëª…, ì‚¬ì›ì¶œì…ê¸°ë¡.ì…ì¶œì…ì‹œê°„, ì‚¬ì›ì¶œì…ê¸°ë¡.ì§€ì—­, ì‚¬ì›ì¶œì…ê¸°ë¡.ì…ì¶œì…êµ¬ë¶„
from ì‚¬ì›ì¶œì…ê¸°ë¡,
     (select ë¶€ì„œê´€ë¦¬ì.ì‚¬ì›ë²ˆí˜¸ as 'ì‚¬ì›ë²ˆí˜¸', ì‚¬ì›.ì´ë¦„ as 'ì´ë¦„', ê¸‰ì—¬.ì—°ë´‰ as 'ì—°ë´‰', ì§ê¸‰.ì§ê¸‰ëª… as 'ì§ê¸‰ëª…'
      from ë¶€ì„œê´€ë¦¬ì
             inner join ë¶€ì„œ on ë¶€ì„œê´€ë¦¬ì.ë¶€ì„œë²ˆí˜¸ = ë¶€ì„œ.ë¶€ì„œë²ˆí˜¸
             inner join ì‚¬ì› on ë¶€ì„œê´€ë¦¬ì.ì‚¬ì›ë²ˆí˜¸ = ì‚¬ì›.ì‚¬ì›ë²ˆí˜¸
             inner join ê¸‰ì—¬ on ë¶€ì„œê´€ë¦¬ì.ì‚¬ì›ë²ˆí˜¸ = ê¸‰ì—¬.ì‚¬ì›ë²ˆí˜¸
             inner join ì§ê¸‰ on ë¶€ì„œê´€ë¦¬ì.ì‚¬ì›ë²ˆí˜¸ = ì§ê¸‰.ì‚¬ì›ë²ˆí˜¸
      where ë¶€ì„œ.ë¹„ê³  = 'active'
        and ë¶€ì„œê´€ë¦¬ì.ì¢…ë£Œì¼ì >= curdate()
        and ê¸‰ì—¬.ì¢…ë£Œì¼ì >= curdate()
        and ì§ê¸‰.ì¢…ë£Œì¼ì >= curdate()
      order by `ì—°ë´‰` desc
        limit 5) as ì—°ë´‰ìƒìœ„5ìœ„
where ì…ì¶œì…êµ¬ë¶„ = 'O'
  and ì‚¬ì›ì¶œì…ê¸°ë¡.ì‚¬ì›ë²ˆí˜¸ = ì—°ë´‰ìƒìœ„5ìœ„.ì‚¬ì›ë²ˆí˜¸
order by ì—°ë´‰ desc
;
```

* ì‹¤í–‰ ê²°ê³¼  
  <img src="/images/a1.png" width="900"/>

#### ì¿¼ë¦¬ì— ëŒ€í•œ ì„¤ëª…  
ìš°ì„ , ì¡°íšŒí•  ì»¬ëŸ¼ë“¤ì„ ë¨¼ì € ì‚´í´ë³´ì•˜ì–´ìš”. ì‚¬ì›ë²ˆí˜¸, ì´ë¦„, ì—°ë´‰, ì§ê¸‰ëª…ì€ ì—°ë´‰ TOP 5 í…Œì´ë¸”ì„ ë§Œë“¤ë©° ë½‘ì•„ë‚¼ ìˆ˜ ìˆëŠ” ê°’ì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆì–´ìš”.
ê·¸ë˜ì„œ í¬ê²Œ ì—°ë´‰ìƒìœ„5ìœ„ í…Œì´ë¸”ê³¼, ì‚¬ì›ì¶œì…ê¸°ë¡ ë‘ í…Œì´ë¸”ì„ ê°€ì¥ ê²‰ ì¿¼ë¦¬ì—ì„œ ì´ìš©í•˜ê¸°ë¡œ ìƒê°í–ˆì–´ìš”.
ë‚´ë¶€ ì—°ë´‰ìƒìœ„5ìœ„ í…Œì´ë¸”ì„ ë§Œë“¤ê¸° ìœ„í•´ from ì ˆì— ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‚¬ìš©í–ˆì–´ìš”. ì„œë¸Œì¿¼ë¦° ë‚´ë¶€ì—ì„œëŠ” ëª¨ë“  í…Œì´ë¸”ê³¼ ì—°ê´€ê´€ê³„ë¥¼ ê°€ì§„ ë¶€ì„œê´€ë¦¬ì í…Œì´ë¸”ì— ê° í…Œì´ë¸”ë“¤ì„
inner join í•˜ë„ë¡ êµ¬ì„±í–ˆì–´ìš”. ë˜í•œ ì¢…ë£Œì¼ìë¥¼ ì˜¤ëŠ˜ ë‚ ì§œ ì´í›„ë¡œ ì„¤ì •í•¨ìœ¼ë¡œì¨ ê·¼ë¬´ì¤‘ì„ì„ í™•ì¸í–ˆë‹¤. ì´ë•Œ, `curdate()`ì™€ `curtime()`, `now()`ë“±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆëŠ”ë°,
ê°ê°ì˜ ì°¨ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì•„ìš”. 

|CURDATE|CURTIME|NOW|
|--------|------------|--------|
|2021-10-15|22:37:25|2021-10-15 22:37:25|

ì–´ì°¨í”¼ ê°’ì— ì‹œê°„ì€ í¬í•¨ë˜ì–´ìˆì§€ ì•Šê¸°ì— `curdate()`ë¥¼ ì‚¬ìš©í–ˆì–´ìš”. ì´í›„ ì¡°ê±´ì€ ë¬¸ì œì— ë‚˜ì˜¨ëŒ€ë¡œ ì„¤ì •í–ˆì–´ìš”.




---


### A2 - ì¸ë±ìŠ¤ ì„¤ì •ì„ ì¶”ê°€í•˜ì—¬ 50 ms ì´í•˜ë¡œ ë°˜í™˜í•œë‹¤.
```sql
CREATE INDEX I_ì‚¬ì›ë²ˆí˜¸ ON tuning.ì‚¬ì›ì¶œì…ê¸°ë¡ (ì‚¬ì›ë²ˆí˜¸);
```

* ì‹¤í–‰ ê²°ê³¼  
  <img src="/images/a2.png" width="900"/>

* EC2ì— DBë¥¼ ì˜¬ë ¤ë†“ê³  ì—°ê²°í•´ì„œ ì‚¬ìš©í•˜ë‹¤ë³´ë‹ˆ ë„¤íŠ¸ì›Œí¬ì— ë”°ë¼ì„œ Durationì´ ì¼ì •í•˜ì§€ ì•Šë”ë¼êµ¬ìš”.. ğŸ˜  

#### ì¸ë±ìŠ¤ ì„¤ì •ì— ëŒ€í•œ ì´ìœ   
ì‚¬ì›ì¶œì…ê¸°ë¡ì— ëŒ€í•œ Full Table Scanì„ ìµœì í™”í•˜ê¸°ìœ„í•´ ì‚¬ì›ì¶œì…ê¸°ë¡ í…Œì´ë¸”ì˜ ì¸ë±ìŠ¤ ì •ë³´ë¥¼ í™•ì¸í–ˆì–´ìš”. (ìˆœë²ˆ, ì‚¬ì›ë²ˆí˜¸) ìˆœìœ¼ë¡œëŠ” ì¸ë±ìŠ¤ê°€ ê±¸ë ¤ìˆì—ˆì§€ë§Œ, ì‚¬ì›ë²ˆí˜¸ ë‹¨ì¼ë¡œëŠ” ìƒì„±ë˜ì–´ìˆì§€ ì•Šì•˜ì–´ìš”. ì¡°ê±´ì ˆì—ì„œ ì‚¬ì›ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ê¸°ì— ì‚¬ì›ë²ˆí˜¸ ë‹¨ì¼ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì£¼ì—ˆì–´ìš”.

[ì§ˆë¬¸]  
1. ì…ì¶œì…êµ¬ë¶„ì˜ equal ì—°ì‚°ìë¡œ í•œë²ˆ ê±°ë¥´ê³ , ì‚¬ì›ë²ˆí˜¸ë„ equalë¡œ ê±°ë¥´ë‹ˆ (ì…ì¶œì…êµ¬ë¶„, ì‚¬ì›ë²ˆí˜¸)ì™€ ê°™ì€ í˜•íƒœë¡œ ì¸ë±ìŠ¤ë¥¼ ê±°ëŠ”ê²Œ ë” ì¢‹ì§€ ì•Šì„ê¹Œ? ë¼ëŠ” ìƒê°ì´
ë“¤ì—ˆì–´ìš”. ê·¼ë° ë³„ ì°¨ì´ê°€ ì—†ë”ë¼êµ¬ìš”? ì´ìœ ê°€ ë­˜ê¹Œìš”?

[ë‹µë³€ ì •ë¦¬]
* (ì…ì¶œì…êµ¬ë¶„, ì‚¬ì›ë²ˆí˜¸)ë¡œ ë³µí•©ì¸ë±ìŠ¤ë¥¼ ê±¸ê²Œ ë˜ë©´, ë™ë“± ë¹„êµë¥¼ constë¡œ ìˆ˜í–‰í•œë‹¤.  
* ë”°ë¼ì„œ ì¿¼ë¦¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë ˆì½”ë“œ ìˆ˜ê°€ ì‚¬ì›ë²ˆí˜¸ë§Œì„ ì¸ë±ìŠ¤ë¡œ ê±¸ì—ˆì„ ë•Œë³´ë‹¤ ì ì–´ì§„ë‹¤.  
* ë˜í•œ ì´ë¯¸ constë¡œ ê±¸ëŸ¬ì§„ ê°’ì—ì„œ ë˜ constë¡œ ê±°ë¥´ê¸° ë•Œë¬¸ì— filteringì—ì„œë„ ì´ì ì´ ì¡´ì¬í•œë‹¤.  
-> ë³µí•©ì¸ë±ìŠ¤ì™€ ì‚¬ì›ë²ˆí˜¸ ë‹¨ì¼ì¸ë±ìŠ¤ê°„ì—ëŠ” ì°¨ì´ê°€ ìˆì§€ë§Œ, ê²°ê³¼ row ìˆ˜ ìì²´ê°€ í° ì°¨ì´ê°€ ì—†ê¸° ë•Œë¬¸ì— í˜„ ë°ì´í„° ìƒí™©ì—ì„œëŠ” ë³„ ì°¨ì´ê°€ ì—†ê²Œ ëŠê»´ì§ˆ ìˆ˜ ìˆë‹¤.  

---


## ERD of B
  <img src="/images/erd-of-b.png" width="800"/>

## B. ì¸ë±ìŠ¤ ì„¤ê³„
* ì¡°ê±´  
  ì£¼ì–´ì§„ ë°ì´í„°ì…‹ì„ í™œìš©í•˜ì—¬ ì•„ë˜ ì¡°íšŒ ê²°ê³¼ë¥¼ 100ms ì´í•˜ë¡œ ë°˜í™˜

### B1 - Coding as a Hobby ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ì„¸ìš”.

* programmer.idì— PK ì§€ì •
* hobbyì— index ì§€ì •
* filesortì™€ ì„ì‹œ í…Œì´ë¸”ì„ ì—†ì• ê¸° ìœ„í•´ `order by percentage desc` -> `order by null`ë¡œ ë³€ê²½í•´ë³´ì•˜ëŠ”ë°, ê·¸ë ‡ê²Œ ë§ì€ ì°¨ì´ê°€ ë‚˜ì§€ ì•Šì•„ 
  ìš°ì„  Yesê°€ ìœ„ì— ë‚˜ì˜¤ë„ë¡ `order by percentage desc`ë¥¼ ìœ ì§€í–ˆìŠµë‹ˆë‹¤.

```sql
CREATE INDEX I_hobby ON subway.programmer (hobby);

select hobby as 'coding as a hobby', round((count(id) * 100 / (select count(*) from subway.programmer)), 1) as 'percentage'
from subway.programmer
group by hobby
order by percentage desc;
```

* ì‹¤í–‰ ê²°ê³¼  

  <img src="/images/b1.png" width="900"/>

* Duration: 0.053sec  

#### ì¿¼ë¦¬ ë° ì¸ë±ìŠ¤ì— ëŒ€í•œ ì´ìœ   
ìš°ì„ , ì¡°ê±´ì€ ë¹„êµì  ì‰¬ìš´ í¸ì´ê¸°ì— ì¿¼ë¦¬ì— ëŒ€í•œ ì´ìœ ëŠ” íŒ¨ì“°í• ê²Œìš”. ì•„ë§ˆ ëŒ€ë¶€ë¶„ ë™ì¼í• ê±°ë¼ ìƒê°í•´ìš”. ê°œì„ ì€ ë¨¼ì € programmer.idì— PKë¥¼ ì§€ì •í•´ë³´ì•˜ì–´ìš”. í…Œì´ë¸”ì˜ í”„ë¼ì´ë¨¸ë¦¬ í‚¤ëŠ” í´ëŸ¬ìŠ¤í„°ë§ì˜ ê¸°ì¤€ì´ ë˜ì–´ìš”. íŠ¹íˆ InnoDBë¥¼ ì‚¬ìš©í•˜ê¸°ì— í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤ë¡œ ì €ì¥ë˜ëŠ” í…Œì´ë¸”ì€ í”„ë¼ì´ë¨¸ë¦¬ í‚¤ ê¸°ë°˜ ê²€ìƒ‰ì´ ë¹¨ë¼ìš”. ê·¸ë˜ì„œ ì„œë¸Œì¿¼ë¦¬ì—ì„œ idë¥¼ í™œìš©í•˜ê³  ìˆê¸°ë„ í•˜ê³ .. ë“±ì˜ ì´ìœ ë¡œ pkë¥¼ ì§€ì •í•´ì¤¬ì–´ìš”. ì¶”ê°€ë¡œ hobbyì— ì¸ë±ìŠ¤ë¥¼ ì§€ì •í•´ë³´ì•˜ì–´ìš”. hobbyì— ì¶”ê°€ ì¸ë±ìŠ¤ë¥¼ ì§€ì •í•´ì¤€ ì´ìœ ëŠ” group by ì ˆì— ì¸ë±ìŠ¤ë¥¼ ì ìš©í•´ ì¸ë±ìŠ¤ ìŠ¤ìº”ì´ ì¼ì–´ë‚˜ê¸¸ ì˜ë„í•œ ê±°ì˜€ì–´ìš”. í•˜ì§€ë§Œ count(*)ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ì„œ ê·¸ëŸ°ì§€, ê²°êµ­ì—” full index scanì´ ì¼ì–´ë‚˜ì„œ ê·¸ë ‡ê²Œ íš¨ê³¼ëŠ” ì—†ì–´ë³´ì´ë„¤ìš”. ğŸ¥²




---


### B2 - í”„ë¡œê·¸ë˜ë¨¸ë³„ë¡œ í•´ë‹¹í•˜ëŠ” ë³‘ì› ì´ë¦„ì„ ë°˜í™˜í•˜ì„¸ìš”.
* (covid.id, hospital.name)  

```sql
select c.programmer_id as programmer, h.name as hospital_name
from subway.hospital h
       inner join subway.covid c on h.id = c.hospital_id
       inner join subway.programmer p on c.programmer_id = p.id;
```
* ì‹¤í–‰ ê²°ê³¼

  <img src="/images/b2.png" width="900"/>
  

* Duration: 0.023sec   

#### ì¿¼ë¦¬ ë° ì¸ë±ìŠ¤ì— ëŒ€í•œ ì´ìœ 
ì´ë²ˆì—ëŠ” ì¸ë±ìŠ¤ë¥¼ ë”°ë¡œ ê±¸ì§€ ì•Šê³  pkë¡œë§Œ í•´ê²°í–ˆì–´ìš”.

Total number of rows in covid table -> 318325  
Total number of rows in hospital table -> 32  
Total number of rows in student table -> 98855  

covid í…Œì´ë¸”ì„ í†µí•´ programmer_id ë° hospital_idì— ëª¨ë‘ ì ‘ê·¼í•  ìˆ˜ ìˆê¸°ì—, covidë¥¼ ê¸°ì¤€ìœ¼ë¡œ joinì„ ìˆ˜í–‰í–ˆì—ˆì–´ìš”. í•˜ì§€ë§Œ ë” ì ì€ í–‰ì˜ ê°œìˆ˜ë¥¼ ê°€ì§„ 
hospitalì„ ë“œë¼ì´ë¹™ í…Œì´ë¸”ë¡œ ì„¤ì •í•´ë³´ì•˜ëŠ”ë°, ê¸°ì¡´ê³¼ ì‚¬ì‹¤ìƒ ë‹¤ë¦„ì—†ëŠ” ê²°ê³¼ê°€ ë‚˜ì™”ì–´ìš”. ê²°êµ­ì—” 3 í…Œì´ë¸”ì„ ëª¨ë‘ inner join í•˜ëŠ” ê²ƒì´ë‹¤ ë³´ë‹ˆ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ëŠ” ê²ƒ ê°™ì•„ìš”. (ë‡Œí”¼ì…œ)
ì¶”ê°€ì ìœ¼ë¡œ covid.programmer_id, covid.hospital_idì— fkë¥¼ ì„¤ì •í•´ì£¼ì—ˆì–´ìš”. í•˜ì§€ë§Œ ì˜¤íˆë ¤ fk ì„¤ì • ì „ Unique Key Lookupì„ ë„ëŠ” ê²Œ ë” ë‚˜ì€ ê²ƒ ê°™ì•„ì„œ, fkëŠ” ë‹¤ì‹œ ì§€ì› ì–´ìš”. ì‚¬ì‹¤ í•˜ë©´ì„œë„ ì˜³ì€ ë°©í–¥ìœ¼ë¡œ í•˜ê³ ìˆëŠ”ê²Œ ë§ëŠ”ì§€ ì˜ë¬¸ì´ ë“œë„¤ìš”.. [ì§ˆë¬¸] ì´ ë¬¸ì œì— ëŒ€í•´ ì—ì–´ëŠ” ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±ì‹œì¼°ë‚˜ìš”?



---


### B3 - í”„ë¡œê·¸ë˜ë°ì´ ì·¨ë¯¸ì¸ í•™ìƒ í˜¹ì€ ì£¼ë‹ˆì–´(0-2ë…„)ë“¤ì´ ë‹¤ë‹Œ ë³‘ì› ì´ë¦„ì„ ë°˜í™˜í•˜ê³  user.id ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì„¸ìš”.
* (covid.id, hospital.name, user.Hobby, user.DevType, user.YearsCoding)  

ìš°ì„  ì´ ë¬¸ì œëŠ” ì”¨ìœ ê»˜ì„  ì–´ë–¤ ì˜ë„ì¸ì§€ ëª¨ë¥´ê² ì§€ë§Œ ì €ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•´ì„í•˜ê³  í’€ì´í–ˆì–´ìš”.
> í”„ë¡œê·¸ë˜ë°ì´ ì·¨ë¯¸ì¸ í•™ìƒ í˜¹ì€ í”„ë¡œê·¸ë˜ë°ì´ ì·¨ë¯¸ì¸ ì£¼ë‹ˆì–´(0-2ë…„)ë“¤ì´ ë‹¤ë‹Œ ë³‘ì› ì´ë¦„ì„ ë°˜í™˜í•˜ê³  user.id ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬í•˜ì„¸ìš”.

#### Before
```sql
select p.id as programmer, h.name as hospital_name
from subway.covid c
       inner join subway.programmer p on c.programmer_id = p.id
       inner join subway.hospital h on c.hospital_id = h.id
where p.hobby = 'Yes'
  and
  (
        p.dev_type like '%student%'
      or
        p.years_coding = '0-2 years'
    )
order by p.id;
```
* Duration: 0.994sec  
ê°œì„ ì´ í•„ìš”í•˜ë„¤ìš”. ã… 

#### After
```sql
select p.id as programmer, h.name as hospital_name
from subway.covid c
       inner join subway.programmer p on c.programmer_id = p.id
       inner join subway.hospital h on c.hospital_id = h.id
where p.hobby = 'Yes'
  and
  (
        p.dev_type like '%student%'
      or
        p.years_coding = '0-2 years'
    );
```

* ì‹¤í–‰ ê²°ê³¼

  <img src="/images/b3.png" width="900"/>
  
0.994ì—ì„œ 0.048ë¡œ ê°œì„ ë˜ì—ˆì–´ìš”.  
* Duration: 0.048sec

#### ì¿¼ë¦¬ ë° ì¸ë±ìŠ¤ì— ëŒ€í•œ ì´ìœ 
Programmer.idê°€ ì´ë¯¸ selectì ˆì—ì„œ ì‚¬ìš©ë˜ê³  ìˆê³ , programmer.idëŠ” pkì´ì ì¸ë±ìŠ¤ì´ë¯€ë¡œ í•­ìƒ ì •ë ¬ ìƒíƒœë¥¼ ìœ ì§€í•´ìš”. ë”°ë¼ì„œ order by ì ˆì„ ìƒëµí•´ ë¶ˆí•„ìš”í•œ sort ë° filesortë¥¼ ì¤„ì¼ ìˆ˜ ìˆì—ˆì–´ìš”.

[ì§ˆë¬¸]
* ê·¸ëŸ¼ ì´ë¯¸ p.idë¡œ ì†ŒíŠ¸ê°€ ëœ ìƒíƒœì¸ë°, order by ì ˆì— p.idë¥¼ ëª…ì‹œí•´ì£¼ë”ë¼ë„ filesortê°€ ë°œìƒí•˜ì§€ ì•Šì•„ì•¼í•˜ëŠ”ê±° ì•„ë‹ê¹Œìš”? ì™œ order byë¡œ ëª…ì‹œí•˜ë©´ ë¶ˆí•„ìš”í•œ ì •ë ¬ì´ ë°œìƒí•˜ëŠ”ì§€ í˜¹ì‹œ ì•„ì‹œë‚˜ìš”?



---


### B4 - ì„œìš¸ëŒ€ë³‘ì›ì— ë‹¤ë‹Œ 20ëŒ€ India í™˜ìë“¤ì„ ë³‘ì›ì— ë¨¸ë¬¸ ê¸°ê°„ë³„ë¡œ ì§‘ê³„í•˜ì„¸ìš”.
* (covid.Stay)  

#### Before
```sql
select c.stay, count(c.id)
from subway.covid c
       inner join subway.hospital h on c.hospital_id = h.id
       inner join
     (
       select p.id
       from subway.programmer p
              inner join subway.member m on p.member_id = m.id
       where p.country = 'India'
         and m.age between 20 and 29
     )
       as mp
     on c.programmer_id = mp.id
where h.name = 'ì„œìš¸ëŒ€ë³‘ì›'
group by c.stay;
```
* ì‹¤í–‰ ê²°ê³¼
  <img src="/images/b4-result.png" width="900"/>
> ìœ„ ì´ë¯¸ì§€ëŠ” B4ì— ëŒ€í•œ ì‹¤í–‰ê²°ê³¼ê°€ ì—†ë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹«ê³  ë’¤ëŠ¦ê²Œ ì¶”ê°€í•œì§€ë¼ Duration ì—†ì´ ê²°ê³¼ë§Œ ìˆëŠ” ì  ì–‘í•´ë¶€íƒë“œë ¤ìš” ğŸ˜… ì´ë¯¸ Afterì´ ìˆ˜í–‰ëœ í›„ì—¬ì„œ.. ã…ã…

* Duration: 0.142sec  

#### After
ë¨¼ì €, ì¡°ê±´ì ˆì— ê±¸ë¦° ê°’ë“¤ì— ëŒ€í•œ ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¡°íšŒí•´ë³´ì•˜ì–´ìš”.
```sql
-- select count(distinct(country)) from subway.programmer; 184
-- select count(distinct(age)) from subway.member; 43
-- select count(distinct(name)) from subway.hospital; 32
-- select count(distinct(stay)) from subway.covid; 11
```
ì¹´ë””ë„ë¦¬í‹°ë¥¼ ì¡°íšŒí•˜ë©° ë¬¸ë“, ì´ì „ B2ë¥¼ ì§„í–‰í•˜ë©° í¬ê¸°í–ˆë˜ fkì— ëŒ€í•´ ë‹¤ì‹œ ê³ ë¯¼í•´ë³´ì•˜ì–´ìš”. ì‚¬ì‹¤, ì•Œê³ ë³´ë‹ˆ covid.hospital_idì™€ hospital.idëŠ” ê°™ì€ ê°’ì„ ë‚˜íƒ€ë‚´ì§€ë§Œ ì„œë¡œ ë‹¤ë¥¸ íƒ€ì…ì„ ê°–ê³  ìˆì—ˆì–´ìš”. ê·¸ë˜ì„œ covid.hospital_idë„ hospital.idì™€ ê°™ì´ INT(11)ë¡œ íƒ€ì…ì„ ë§ì¶˜ ë’¤, fkë¥¼ ìƒì„±í•´ì¤¬ì–´ìš”. fkë¥¼ ìƒì„±í•˜ê³  ë‚˜ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ 2ë²ˆì§¸ Full Table Scanì´ Non-Unique Key Lookupìœ¼ë¡œ ë³€ê²½ë˜ì—ˆì–´ìš”.

  <img src="/images/b4-1.png" width="900"/>

ì¶”ê°€ì ìœ¼ë¡œ programmerì™€ memberë„ fkë¥¼ í˜•ì„±í•´ì£¼ì—ˆì–´ìš”. ë˜í•œ covid.stayë„ ì¹´ë””ë„ë¦¬í‹°ëŠ” ë‚®ìœ¼ë‚˜ group by ì ˆì—ì„œ ì´ìš©ë˜ê³  ìˆê¸°ì— ì¸ë±ìŠ¤ë¡œ ì¶”ê°€í•´ì£¼ì—ˆì–´ìš”. ì´í›„, Durationì´ **0.052sec**ìœ¼ë¡œ ì¤„ì—ˆì–´ìš”. hospital.nameê¹Œì§€ ì¸ë±ìŠ¤ë¥¼ ê±¸ë©´, ì„±ëŠ¥ì´ ë” ê°œì„ ë  ê²ƒ ê°™ì§€ë§Œ TEXT í•„ë“œë¥¼ êµ³ì´ varcharë¡œ ë³€ê²½í•˜ê³  ì‹¶ì§€ ì•Šê³ , ì§€ê¸ˆ ìˆ˜ì¤€ë„ ë§Œì¡±í• ë§Œí•˜ê¸°ì— êµ³ì´ ì¶”ê°€í•˜ì§€ ì•Šì•˜ì–´ìš”.

 <img src="/images/b4-2.png" width="900"/>

* Duration: 0.052sec  


---


### B5 - ì„œìš¸ëŒ€ë³‘ì›ì— ë‹¤ë‹Œ 30ëŒ€ í™˜ìë“¤ì„ ìš´ë™ íšŸìˆ˜ë³„ë¡œ ì§‘ê³„í•˜ì„¸ìš”.
* (user.Exercise)  

#### Before
```sql
select p.exercise, count(p.id) as number_of_patient
from subway.programmer p 
inner join subway.member m on p.member_id = m.id
inner join
	(
	select c.programmer_id as id
	from subway.covid c
	inner join subway.hospital h on c.hospital_id = h.id
	where h.name = 'ì„œìš¸ëŒ€ë³‘ì›'
	) as cp
on p.id = cp.id
where m.age between 30 and 39
group by p.exercise;
```
* Duration: 0.127sec

#### After
ì´ë²ˆì—ëŠ” ì´ì „ì— í•´ë³´ì§€ ì•Šì•˜ë˜, ë³µí•©ì¸ë±ìŠ¤ë¥¼ ê±¸ì–´ë³´ì•˜ì–´ìš”. joinë¬¸ì˜ ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” member_id, hospital_idë¥¼ 1,2 ìˆœì„œë¡œ covid í…Œì´ë¸”ì—ì„œ ë³µí•©ì¸ë±ìŠ¤ë¥¼ ìƒì„±í–ˆì–´ìš”. ë³µí•©ì¸ë±ìŠ¤ë¥¼ ê³ ë ¤í•œ ì´ìœ ëŠ” hospital.nameê³¼ programmer.exercise ëª¨ë‘ TEXT í•„ë“œì˜€ê¸°ì—, B4ì™€ ë™ì¼í•œ ì´ìœ ë¡œ ì¸ë±ì‹±ì„ ê³ ë ¤í•˜ì§€ ì•Šì•˜ì–´ìš”. ë”°ë¼ì„œ ë‹¤ë¥¸ ì¸ë±ì‹± ë°©ë²•ì„ ì°¾ë˜ ì¤‘ ë³µí•©ì¸ë±ìŠ¤ë¥¼ ì‹œë„í•´ë³´ì•˜ì–´ìš”. ì´ ë¬¸ì œë¥¼ í†µí•´ B4ì—ì„œë„ ë³µí•© ì¸ë±ìŠ¤ë¥¼ ì ìš©í•´ì£¼ë©´ ë” ê°œì„ ë  ìˆ˜ ìˆê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆì–´ìš” ã…ã… ì—ì–´ëŠ” ì–´ë–»ê²Œ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ì…¨ë‚˜ ê¶ê¸ˆí•˜ë„¤ìš”.

 <img src="/images/b5.png" width="900"/>

* Duration: 0.086sec  
